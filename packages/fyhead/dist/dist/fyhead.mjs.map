{"version":3,"file":"fyhead.mjs","sources":["../../src/helpers.ts","../../src/element.ts","../../src/fyhead.ts","../../src/index.ts"],"sourcesContent":["export function generateUUID() {\n  var d = new Date().getTime();\n  var d2 =\n    (typeof performance !== 'undefined' &&\n      performance.now &&\n      performance.now() * 1000) ||\n    0;\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    var r = Math.random() * 16;\n    if (d > 0) {\n      r = (d + r) % 16 | 0;\n      d = Math.floor(d / 16);\n    } else {\n      r = (d2 + r) % 16 | 0;\n      d2 = Math.floor(d2 / 16);\n    }\n    return (c === 'x' ? r : (r & 0x3) | 0x8).toString(16);\n  });\n}\n","import { generateUUID } from './helpers';\n\nexport class ElProperty {\n  key: string;\n  value?: string;\n  constructor(key: string, value?: string) {\n    this.key = key;\n    this.value = value;\n  }\n  toString() {\n    return this.value ? `${this.key}=\"${this.value}\"` : this.key;\n  }\n}\ntype ElTag = 'meta' | 'link' | 'script' | 'title';\n\nexport class El {\n  tag: ElTag;\n  properties: ElProperty[];\n  content?: string;\n  key: string;\n  constructor(\n    tag: ElTag,\n    properties: ElProperty[] = [],\n    key?: string,\n    content?: string\n  ) {\n    this.tag = tag;\n    this.properties = properties;\n    this.content = content;\n    if (key) this.key = key;\n    else this.key = this.getKey();\n  }\n  getKey() {\n    return generateUUID();\n  }\n  toStringProperties() {\n    let propertiesString = '';\n    for (const property of this.properties) {\n      propertiesString += ` ${property.toString()}`;\n    }\n    return propertiesString.trim();\n  }\n  toString() {\n    return `<${this.tag} ${this.toStringProperties()}>${\n      this.content ? this.content : ''\n    }</${this.tag}>`;\n  }\n  toDom(doc: Document) {\n    const el = doc.createElement(this.tag);\n    for (const property of this.properties) {\n      el.setAttribute(property.key, property.value ? property.value : '');\n    }\n    if (this.content) {\n      el.innerText = this.content;\n    }\n    return el;\n  }\n}\n","import { reactive } from 'vue';\nimport type { ShallowReactive } from 'vue';\nimport { generateUUID } from './helpers';\nimport { El, ElProperty } from './element';\n\nconst __fyHeadCount__ = 'fyhead:count';\n\nexport interface FyHeadState {\n  elements: ShallowReactive<{\n    [key: string]: El;\n  }>;\n}\nexport interface FyHeadLazy {\n  name?: string;\n  title?: string;\n  image?: string;\n  imageType?: string;\n  imageWidth?: string;\n  imageHeight?: string;\n  description?: string;\n  published?: string;\n  modified?: string;\n  keywords?: string;\n  type?: 'blog' | 'search' | 'article' | 'website';\n  searchAction?: string;\n  next?: string;\n  prev?: string;\n  canonical?: string;\n  locale?: string;\n  robots?: string;\n  url?: string;\n}\n\nexport class FyHead {\n  state: FyHeadState;\n  constructor() {\n    this.state = reactive({ elements: {} });\n  }\n  reset() {\n    this.state.elements = {};\n  }\n  addTitle(title: string) {\n    if (typeof title !== 'string') return;\n    this.state.elements.title = new El('title', [], 'title', title);\n  }\n  addScript(src: string, key?: string, nonce?: string, async: boolean = false) {\n    if (!key) key = generateUUID();\n    const properties = [new ElProperty('id', key)];\n    if (async) properties.push(new ElProperty('async'));\n    if (nonce) properties.push(new ElProperty('nonce', nonce));\n    this.state.elements[key] = new El('script', properties, key);\n  }\n  addLink(rel: string, href: string, key: string | undefined = undefined) {\n    if (!key) key = generateUUID();\n    this.state.elements[key] = new El(\n      'link',\n      [new ElProperty('rel', rel), new ElProperty('href', href)],\n      key\n    );\n  }\n  addMeta(\n    value: string,\n    content: string,\n    type: 'name' | 'property' = 'property'\n  ) {\n    const key = value + '-' + type;\n    this.state.elements[key] = new El(\n      'meta',\n      [new ElProperty(type, value), new ElProperty('content', content)],\n      key\n    );\n  }\n  renderHeadToString() {\n    let headTags = '';\n    Object.values(this.state.elements).forEach((el) => {\n      headTags += `${el.toString()}\\n`;\n    });\n    const htmlAttrs = '';\n    const bodyAttrs = '';\n    const bodyTags = '';\n    return {\n      headTags,\n      htmlAttrs,\n      bodyAttrs,\n      bodyTags,\n    };\n  }\n  lazySeo(data: FyHeadLazy, reset: boolean = false) {\n    if (data.url) {\n      this.addMeta('og:url', data.url);\n    }\n    if (data.canonical) {\n      this.addLink('canonical', data.canonical);\n    }\n    if (data.robots) {\n      this.addMeta('robots', data.robots, 'name');\n    }\n    if (data.type) {\n      this.addMeta('og:type', data.type);\n    }\n    if (data.title) {\n      this.addTitle(data.title);\n    }\n    if (data.description) {\n      this.addMeta('og:description', data.description);\n      this.addMeta('twitter:description', data.description, 'name');\n      this.addMeta('description', data.description, 'name');\n      this.addMeta('og:description', data.description);\n    }\n    if (data.modified) {\n      this.addMeta('article:modified_time', data.modified);\n    }\n    if (data.published) {\n      this.addMeta('article:published_time', data.published);\n    }\n    if (data.imageWidth && data.imageHeight) {\n      this.addMeta('og:image:width', data.imageWidth);\n      this.addMeta('og:image:height', data.imageHeight);\n    }\n    if (data.imageType) {\n      this.addMeta('og:image:type', data.imageType);\n    }\n    if (data.image) {\n      this.addMeta('og:image', data.image);\n      this.addMeta('twitter:image', data.image, 'name');\n    }\n    if (data.next) {\n      this.addLink('next', data.next);\n    }\n    if (data.prev) {\n      this.addLink('prev', data.prev);\n    }\n  }\n  static injectFyHead(\n    head: ShallowReactive<{\n      [key: string]: El;\n    }>\n  ) {\n    const newElements: Element[] = [];\n    const oldElements: Element[] = [];\n    if (document && document.head) {\n      let headCountEl = document.querySelector(\n        `meta[name=\"${__fyHeadCount__}\"]`\n      );\n      const headCount = headCountEl\n        ? Number(headCountEl.getAttribute('content'))\n        : 0;\n\n      if (headCountEl) {\n        for (\n          let i = 0, j = headCountEl.previousElementSibling;\n          i < headCount;\n          i++\n        ) {\n          if (j) {\n            oldElements.push(j);\n          }\n          j = j ? j.previousElementSibling : null;\n        }\n      }\n      if (!headCountEl) headCountEl = document.createElement('meta');\n      headCountEl.setAttribute('name', __fyHeadCount__);\n      headCountEl.setAttribute('content', '0');\n      document.head.append(headCountEl);\n\n      Object.values(head).forEach((el) => {\n        const elDom = el.toDom(document);\n        newElements.push(elDom);\n      });\n\n      newElements.forEach((n) => {\n        document.head.insertBefore(n, headCountEl);\n      });\n      oldElements.forEach((n) => {\n        n.remove();\n      });\n\n      headCountEl.setAttribute('content', newElements.length.toString());\n    }\n\n    return newElements;\n  }\n}\n","import type { App } from 'vue';\nimport { inject, watch, onUnmounted } from 'vue';\nimport { FyHead } from './fyhead';\nimport type { FyHeadLazy } from './fyhead';\n\nconst useFyHead = () => {\n  const fyhead = inject<FyHead>('fyhead');\n  if (!fyhead) throw new Error('Did you apply app.use(fyhead)?');\n  const __isBrowser__ = typeof window !== 'undefined';\n  if (__isBrowser__) {\n    watch(fyhead.state.elements, (v) => {\n      FyHead.injectFyHead(v);\n    });\n    onUnmounted(() => {\n      fyhead.reset();\n    });\n  }\n  return fyhead;\n};\n\nconst createFyHead = () => {\n  const fyHead = new FyHead();\n\n  fyHead.reset();\n\n  const fyHeadPlugin = {\n    install(app: App) {\n      if (app.config.globalProperties) {\n        app.config.globalProperties.$fyhead = fyHead;\n        app.provide('fyhead', fyHead);\n      }\n    },\n  };\n  return fyHeadPlugin;\n};\n\nexport { useFyHead, createFyHead, FyHeadLazy };\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,eAAe;AAC7B,MAAI,IAAI,IAAI,KAAK,EAAE,QACf,GAAA,KACD,OAAO,eAAgB,eACtB,YAAY,OACZ,YAAY,QAAQ,OACtB;AACF,SAAO,uCAAuC,QAAQ,SAAS,CAAC,MAAM;AAChE,QAAA,IAAI,KAAK,OAAA,IAAW;AACxB,WAAI,IAAI,KACN,KAAK,IAAI,KAAK,KAAK,GACnB,IAAI,KAAK,MAAM,IAAI,EAAE,MAErB,KAAK,KAAK,KAAK,KAAK,GACpB,KAAK,KAAK,MAAM,KAAK,EAAE,KAEjB,MAAM,MAAM,IAAK,IAAI,IAAO,GAAK,SAAS,EAAE;AAAA,EAAA,CACrD;AACH;AChBO,MAAM,WAAW;AAAA,EAGtB,YAAY,KAAa,OAAgB;AAClC,SAAA,MAAM,KACX,KAAK,QAAQ;AAAA,EACf;AAAA,EACA,WAAW;AACT,WAAO,KAAK,QAAQ,GAAG,KAAK,QAAQ,KAAK,WAAW,KAAK;AAAA,EAC3D;AACF;AAGO,MAAM,GAAG;AAAA,EAKd,YACE,KACA,aAA2B,CAAA,GAC3B,KACA,SACA;AACA,SAAK,MAAM,KACX,KAAK,aAAa,YAClB,KAAK,UAAU,SACX,MAAK,KAAK,MAAM,MACf,KAAK,MAAM,KAAK;EACvB;AAAA,EACA,SAAS;AACP,WAAO,aAAa;AAAA,EACtB;AAAA,EACA,qBAAqB;AACnB,QAAI,mBAAmB;AACvB,eAAW,YAAY,KAAK;AACN,0BAAA,IAAI,SAAS,SAAS;AAE5C,WAAO,iBAAiB;EAC1B;AAAA,EACA,WAAW;AACF,WAAA,IAAI,KAAK,OAAO,KAAK,mBAAA,KAC1B,KAAK,UAAU,KAAK,UAAU,OAC3B,KAAK;AAAA,EACZ;AAAA,EACA,MAAM,KAAe;AACnB,UAAM,KAAK,IAAI,cAAc,KAAK,GAAG;AACrC,eAAW,YAAY,KAAK;AAC1B,SAAG,aAAa,SAAS,KAAK,SAAS,QAAQ,SAAS,QAAQ,EAAE;AAEpE,WAAI,KAAK,YACP,GAAG,YAAY,KAAK,UAEf;AAAA,EACT;AACF;ACpDA,MAAM,kBAAkB;AA4BjB,MAAM,OAAO;AAAA,EAElB,cAAc;AACZ,SAAK,QAAQ,SAAS,EAAE,UAAU,CAAA,EAAI,CAAA;AAAA,EACxC;AAAA,EACA,QAAQ;AACD,SAAA,MAAM,WAAW;EACxB;AAAA,EACA,SAAS,OAAe;AAClB,WAAO,SAAU,aACrB,KAAK,MAAM,SAAS,QAAQ,IAAI,GAAG,SAAS,CAAA,GAAI,SAAS,KAAK;AAAA,EAChE;AAAA,EACA,UAAU,KAAa,KAAc,OAAgB,QAAiB,IAAO;AACtE,YAAK,MAAM,aAAa;AAC7B,UAAM,aAAa,CAAC,IAAI,WAAW,MAAM,GAAG,CAAC;AACzC,aAAO,WAAW,KAAK,IAAI,WAAW,OAAO,CAAC,GAC9C,SAAO,WAAW,KAAK,IAAI,WAAW,SAAS,KAAK,CAAC,GACzD,KAAK,MAAM,SAAS,OAAO,IAAI,GAAG,UAAU,YAAY,GAAG;AAAA,EAC7D;AAAA,EACA,QAAQ,KAAa,MAAc,MAA0B,QAAW;AACjE,YAAK,MAAM,aAAa,IAC7B,KAAK,MAAM,SAAS,OAAO,IAAI;AAAA,MAC7B;AAAA,MACA,CAAC,IAAI,WAAW,OAAO,GAAG,GAAG,IAAI,WAAW,QAAQ,IAAI,CAAC;AAAA,MACzD;AAAA,IAAA;AAAA,EAEJ;AAAA,EACA,QACE,OACA,SACA,OAA4B,YAC5B;AACM,UAAA,MAAM,QAAQ,MAAM;AACrB,SAAA,MAAM,SAAS,OAAO,IAAI;AAAA,MAC7B;AAAA,MACA,CAAC,IAAI,WAAW,MAAM,KAAK,GAAG,IAAI,WAAW,WAAW,OAAO,CAAC;AAAA,MAChE;AAAA,IAAA;AAAA,EAEJ;AAAA,EACA,qBAAqB;AACnB,QAAI,WAAW;AACf,WAAA,OAAO,OAAO,KAAK,MAAM,QAAQ,EAAE,QAAQ,CAAC,OAAO;AACrC,kBAAA,GAAG,GAAG;;IAAS,CAC5B,GAIM;AAAA,MACL;AAAA,MACA,WALgB;AAAA,MAMhB,WALgB;AAAA,MAMhB,UALe;AAAA,IAAA;AAAA,EAOnB;AAAA,EACA,QAAQ,MAAkB,QAAiB,IAAO;AAC5C,SAAK,OACP,KAAK,QAAQ,UAAU,KAAK,GAAG,GAE7B,KAAK,aACP,KAAK,QAAQ,aAAa,KAAK,SAAS,GAEtC,KAAK,UACP,KAAK,QAAQ,UAAU,KAAK,QAAQ,MAAM,GAExC,KAAK,QACP,KAAK,QAAQ,WAAW,KAAK,IAAI,GAE/B,KAAK,SACP,KAAK,SAAS,KAAK,KAAK,GAEtB,KAAK,gBACP,KAAK,QAAQ,kBAAkB,KAAK,WAAW,GAC/C,KAAK,QAAQ,uBAAuB,KAAK,aAAa,MAAM,GAC5D,KAAK,QAAQ,eAAe,KAAK,aAAa,MAAM,GACpD,KAAK,QAAQ,kBAAkB,KAAK,WAAW,IAE7C,KAAK,YACP,KAAK,QAAQ,yBAAyB,KAAK,QAAQ,GAEjD,KAAK,aACP,KAAK,QAAQ,0BAA0B,KAAK,SAAS,GAEnD,KAAK,cAAc,KAAK,gBAC1B,KAAK,QAAQ,kBAAkB,KAAK,UAAU,GAC9C,KAAK,QAAQ,mBAAmB,KAAK,WAAW,IAE9C,KAAK,aACP,KAAK,QAAQ,iBAAiB,KAAK,SAAS,GAE1C,KAAK,UACP,KAAK,QAAQ,YAAY,KAAK,KAAK,GACnC,KAAK,QAAQ,iBAAiB,KAAK,OAAO,MAAM,IAE9C,KAAK,QACP,KAAK,QAAQ,QAAQ,KAAK,IAAI,GAE5B,KAAK,QACP,KAAK,QAAQ,QAAQ,KAAK,IAAI;AAAA,EAElC;AAAA,EACA,OAAO,aACL,MAGA;AACA,UAAM,cAAyB,CAAA,GACzB,cAAyB;AAC3B,QAAA,YAAY,SAAS,MAAM;AAC7B,UAAI,cAAc,SAAS;AAAA,QACzB,cAAc;AAAA,MAAA;AAEhB,YAAM,YAAY,cACd,OAAO,YAAY,aAAa,SAAS,CAAC,IAC1C;AAEA,UAAA;AACF,iBACM,IAAI,GAAG,IAAI,YAAY,wBAC3B,IAAI,WACJ;AAEI,eACF,YAAY,KAAK,CAAC,GAEpB,IAAI,IAAI,EAAE,yBAAyB;AAGlC,sBAAa,cAAc,SAAS,cAAc,MAAM,IAC7D,YAAY,aAAa,QAAQ,eAAe,GAChD,YAAY,aAAa,WAAW,GAAG,GACvC,SAAS,KAAK,OAAO,WAAW,GAEhC,OAAO,OAAO,IAAI,EAAE,QAAQ,CAAC,OAAO;AAC5B,cAAA,QAAQ,GAAG,MAAM,QAAQ;AAC/B,oBAAY,KAAK,KAAK;AAAA,MACvB,CAAA,GAED,YAAY,QAAQ,CAAC,MAAM;AAChB,iBAAA,KAAK,aAAa,GAAG,WAAW;AAAA,MAC1C,CAAA,GACD,YAAY,QAAQ,CAAC,MAAM;AACzB,UAAE,OAAO;AAAA,MAAA,CACV,GAED,YAAY,aAAa,WAAW,YAAY,OAAO,UAAU;AAAA,IACnE;AAEO,WAAA;AAAA,EACT;AACF;ACjLA,MAAM,YAAY,MAAM;AAChB,QAAA,SAAS,OAAe,QAAQ;AACtC,MAAI,CAAC;AAAc,UAAA,IAAI,MAAM,gCAAgC;AACvC,SAAA,OAAO,UAAW,gBAEtC,MAAM,OAAO,MAAM,UAAU,CAAC,MAAM;AAClC,WAAO,aAAa,CAAC;AAAA,EAAA,CACtB,GACD,YAAY,MAAM;AAChB,WAAO,MAAM;AAAA,EAAA,CACd,IAEI;AACT,GAEM,eAAe,MAAM;AACnB,QAAA,SAAS,IAAI;AAEnB,SAAA,OAAO,SAEc;AAAA,IACnB,QAAQ,KAAU;AACZ,UAAI,OAAO,qBACb,IAAI,OAAO,iBAAiB,UAAU,QACtC,IAAI,QAAQ,UAAU,MAAM;AAAA,IAEhC;AAAA,EAAA;AAGJ;"}