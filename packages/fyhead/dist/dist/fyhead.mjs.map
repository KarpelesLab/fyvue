{"version":3,"file":"fyhead.mjs","sources":["../../src/helpers.ts","../../src/store.ts","../../src/index.ts"],"sourcesContent":["export function generateUUID() {\n  var d = new Date().getTime();\n  var d2 =\n    (typeof performance !== 'undefined' &&\n      performance.now &&\n      performance.now() * 1000) ||\n    0;\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    var r = Math.random() * 16;\n    if (d > 0) {\n      r = (d + r) % 16 | 0;\n      d = Math.floor(d / 16);\n    } else {\n      r = (d2 + r) % 16 | 0;\n      d2 = Math.floor(d2 / 16);\n    }\n    return (c === 'x' ? r : (r & 0x3) | 0x8).toString(16);\n  });\n}\n","import { defineStore } from 'pinia';\nimport { ref, watchEffect } from 'vue';\nimport type { App, Ref } from 'vue';\nimport type {\n  FyHeadProperties,\n  FyHeadLinks,\n  FyHeadLazy,\n  FyHeadScripts,\n} from './types';\nimport { generateUUID } from './helpers';\n\nconst __fyHeadCount__ = 'fyhead:count';\n\nexport interface FyHeadState {\n  links: FyHeadLinks;\n  metas: FyHeadProperties;\n  scripts: FyHeadScripts;\n  title?: string;\n}\nexport interface FyHead {\n  links: FyHeadLinks;\n  metas: FyHeadProperties;\n  scripts: FyHeadScripts;\n  title?: string;\n}\nexport const useFyheadState = defineStore('fyHeadState', () => {\n  const head = ref<FyHead>({\n    links: {},\n    metas: {},\n    scripts: {},\n    title: undefined,\n  });\n  function $reset() {\n    head.value = {\n      links: {},\n      metas: {},\n      scripts: {},\n      title: undefined,\n    };\n  }\n  function lazySeo(data: FyHeadLazy, reset: boolean = false) {\n    //reset();\n    if (reset) $reset();\n\n    if (data.url) {\n      addMeta('og:url', data.url);\n    }\n    if (data.canonical) {\n      addLink('canonical', data.canonical);\n    }\n    if (data.robots) {\n      addMeta('robots', data.robots, 'name');\n    }\n    if (data.type) {\n      addMeta('og:type', data.type);\n    }\n    if (data.title) {\n      head.value.title = data.title;\n    }\n    if (data.description) {\n      addMeta('og:description', data.description);\n      addMeta('twitter:description', data.description, 'name');\n      addMeta('description', data.description, 'name');\n      addMeta('og:description', data.description);\n    }\n    if (data.modified) {\n      addMeta('article:modified_time', data.modified);\n    }\n    if (data.published) {\n      addMeta('article:published_time', data.published);\n    }\n    if (data.imageWidth && data.imageHeight) {\n      addMeta('og:image:width', data.imageWidth);\n      addMeta('og:image:height', data.imageHeight);\n    }\n    if (data.imageType) {\n      addMeta('og:image:type', data.imageType);\n    }\n    if (data.image) {\n      addMeta('og:image', data.image);\n      addMeta('twitter:image', data.image, 'name');\n    }\n    if (data.next) {\n      addLink('next', data.next);\n    }\n    if (data.prev) {\n      addLink('prev', data.prev);\n    }\n  }\n  function addScript(\n    src: string,\n    id: string | undefined = undefined,\n    async: boolean = false,\n    nonce: string | undefined\n  ) {\n    if (!id) id = generateUUID();\n    head.value.scripts[id] = { key: id, src: src, async: async, nonce: nonce };\n  }\n  function addLink(\n    rel: string,\n    href: string,\n    key: string | undefined = undefined\n  ) {\n    if (!key) key = generateUUID();\n    head.value.links[key] = { key: key, href: href, rel: rel };\n  }\n  function addMeta(\n    value: string,\n    content: string,\n    type: 'name' | 'property' = 'property'\n  ) {\n    head.value.metas[value + type] = {\n      key: value + type,\n      value: value,\n      content: content,\n      type: type,\n    };\n  }\n  function addTitle(_title: string) {\n    head.value.title = _title;\n  }\n  function _headTagsToString() {\n    let headTags = '';\n    Object.values(head.value.metas).forEach((meta) => {\n      headTags += `<meta ${meta.type == 'name' ? 'name' : 'property'}=\"${\n        meta.value\n      }\" content=\"${meta.content}\" />\\n`;\n    });\n    Object.values(head.value.links).forEach((link) => {\n      headTags += `<meta rel=\"${link.rel}\" href=\"${link.href}\" />\\n`;\n    });\n    Object.values(head.value.scripts).forEach((script) => {\n      headTags += `<script id=\"${script.key}\" src=\"${script.src}\" ${\n        script.async ? 'async' : ''\n      } ${script.nonce ? `nonce=${script.nonce}` : ''} />\\n`;\n    });\n    if (head.value.title) headTags += `<title>${head.value.title}</title>`;\n    return headTags;\n  }\n  function _htmlAttrsToString() {\n    return '';\n  }\n  function _bodyAttrsToString() {\n    return '';\n  }\n  function _bodyTagsToString() {\n    return '';\n  }\n  function injectFyHead(_head: FyHead) {\n    const toInject: Element[] = [];\n    const oldElements: Element[] = [];\n    if (document && document.head) {\n      let headCountEl = document.querySelector(\n        `meta[name=\"${__fyHeadCount__}\"]`\n      );\n      const headCount = headCountEl\n        ? Number(headCountEl.getAttribute('content'))\n        : 0;\n\n      if (headCountEl) {\n        for (\n          let i = 0, j = headCountEl.previousElementSibling;\n          i < headCount;\n          i++\n        ) {\n          if (j) {\n            oldElements.push(j);\n          }\n          j = j ? j.previousElementSibling : null;\n        }\n      }\n      if (!headCountEl) headCountEl = document.createElement('meta');\n      headCountEl.setAttribute('name', __fyHeadCount__);\n      headCountEl.setAttribute('content', '0');\n      document.head.append(headCountEl);\n\n      Object.values(_head.metas).forEach((meta) => {\n        const el = document.createElement('meta');\n        el.setAttribute(\n          meta.type == 'property' ? 'property' : 'name',\n          meta.value\n        );\n        el.setAttribute('content', meta.content);\n        toInject.push(el);\n      });\n      Object.values(_head.links).forEach((link) => {\n        const el = document.createElement('link');\n        el.setAttribute('rel', link.rel);\n        el.setAttribute('href', link.href);\n        toInject.push(el);\n      });\n      Object.values(_head.scripts).forEach((script) => {\n        const el = document.createElement('script');\n        el.setAttribute('id', script.key);\n        el.setAttribute('src', script.src);\n        toInject.push(el);\n      });\n\n      if (_head.title) {\n        const el = document.createElement('title');\n        el.text = _head.title;\n        toInject.push(el);\n      }\n      toInject.forEach((n) => {\n        document.head.insertBefore(n, headCountEl);\n      });\n      oldElements.forEach((n) => {\n        n.remove();\n      });\n\n      headCountEl.setAttribute('content', toInject.length.toString());\n    }\n\n    return toInject;\n  }\n  function renderHeadToString() {\n    return {\n      headTags: _headTagsToString(),\n      htmlAttrs: _htmlAttrsToString(),\n      bodyAttrs: _bodyAttrsToString(),\n      bodyTags: _bodyTagsToString(),\n    };\n  }\n  return {\n    head,\n    renderHeadToString,\n    injectFyHead,\n    addTitle,\n    addMeta,\n    addLink,\n    addScript,\n    lazySeo,\n    $reset,\n  };\n});\n","import type { App, Ref } from 'vue';\nimport type { Store } from 'pinia';\nimport { inject, watchEffect, onBeforeUnmount, onBeforeMount } from 'vue';\nimport { useFyheadState, FyHeadState } from './store';\nimport { storeToRefs } from 'pinia';\n\nconst __isBrowser__ = typeof window !== 'undefined';\n// Public Domain/MIT\n\nexport const useFyHead = () => {\n  const fyHeadState = inject('fyhead');\n  if (!fyHeadState) throw new Error('Did you apply app.use(fyhead)?');\n\n  // @ts-expect-error\n  fyHeadState.injectFyHead(fyHeadState.head);\n  if (__isBrowser__) {\n    watchEffect(() => {\n      // @ts-expect-error\n      fyHeadState.injectFyHead(fyHeadState.head);\n    });\n    onBeforeMount(() => {\n      // @ts-expect-error\n      fyHeadState.injectFyHead(fyHeadState.head);\n    });\n    onBeforeUnmount(() => {\n      // @ts-expect-error\n      fyHeadState.$reset();\n      // @ts-expect-error\n      fyHeadState.injectFyHead(fyHeadState.head);\n    });\n  }\n  // @ts-expect-error\n  return storeToRefs(fyHeadState);\n};\n\nexport const createFyHead = () => {\n  const fyHeadState = useFyheadState();\n\n  fyHeadState.$reset();\n\n  const fyHead = {\n    install(app: App) {\n      if (app.config.globalProperties) {\n        app.config.globalProperties.$fyhead = fyHeadState;\n        app.provide('fyhead', fyHeadState);\n      }\n    },\n  };\n  return fyHead;\n};\n"],"names":[],"mappings":"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"}